{"ast":null,"code":"import \"core-js/modules/web.url-search-params.size.js\";\nimport E from 'wangeditor';\nimport { onMounted, reactive, ref } from 'vue';\nimport upload from '@/http/service/upload.js';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'Editor',\n  props: {\n    content: String\n  },\n  emits: ['event'],\n  setup(__props, {\n    expose: __expose,\n    emit\n  }) {\n    const props = __props;\n    const close = () => {\n      editor.txt.clear();\n    };\n    __expose({\n      close\n    }); //暴露子组件的方法或者数据\n    let url = ref('');\n    const uploadImg = async () => {\n      const res = await upload('/adminapi/essay/img', uploadForm);\n      if (res.status !== 201) return ElMessage.error('上传失败');\n      return res.data.data.img;\n    };\n    let uploadForm = reactive({\n      file: '',\n      img: ''\n    });\n    onMounted(async () => {\n      const editor = new E('.edit');\n      editor.config.uploadImgMaxSize = 50 * 1024 * 1024;\n      editor.config.customUploadImg = function (resultFiles, insertImgFn) {\n        let img = window.URL.createObjectURL(new Blob(resultFiles));\n        uploadForm.img = img;\n        uploadForm.file = resultFiles[0];\n        new Promise((resole, reject) => {\n          let res = uploadImg();\n          resole(res);\n        }).then(res => {\n          let imgUrl = `http://localhost:3000/${res}`;\n          insertImgFn(imgUrl);\n        });\n      };\n      editor.create();\n\n      // 初始化数据\n      props.content && editor.txt.html(props.content);\n      // 配置 onchange 回调函数\n      editor.config.onchange = function (newHtml) {\n        emit('event', newHtml);\n      };\n    });\n    const __returned__ = {\n      emit,\n      props,\n      close,\n      get url() {\n        return url;\n      },\n      set url(v) {\n        url = v;\n      },\n      uploadImg,\n      get uploadForm() {\n        return uploadForm;\n      },\n      set uploadForm(v) {\n        uploadForm = v;\n      },\n      get E() {\n        return E;\n      },\n      onMounted,\n      reactive,\n      ref,\n      get upload() {\n        return upload;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["E","onMounted","reactive","ref","upload","ElMessage","close","editor","txt","clear","__expose","url","uploadImg","res","uploadForm","status","error","data","img","file","config","uploadImgMaxSize","customUploadImg","resultFiles","insertImgFn","window","URL","createObjectURL","Blob","Promise","resole","reject","then","imgUrl","create","props","content","html","onchange","newHtml","emit"],"sources":["C:/Users/86191/Desktop/admin/src/components/editor/Editor.vue"],"sourcesContent":["<template>\r\n  <div class=\"edit\">\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport E from 'wangeditor'\r\nimport { onMounted, defineEmits, defineExpose, defineProps, reactive, ref } from 'vue'\r\nimport upload from '@/http/service/upload.js'\r\nimport { ElMessage } from 'element-plus';\r\nconst emit = defineEmits(['event'])\r\nconst props = defineProps({\r\n  content: String\r\n})\r\n\r\nconst close = () => {\r\n  editor.txt.clear()\r\n}\r\n\r\ndefineExpose({ close })//暴露子组件的方法或者数据\r\nlet url = ref('');\r\n\r\nconst uploadImg = async () => {\r\n  const res = await upload('/adminapi/essay/img', uploadForm);\r\n  if (res.status !== 201) return ElMessage.error('上传失败');\r\n  return res.data.data.img;\r\n}\r\n\r\nlet uploadForm = reactive({\r\n  file: '',\r\n  img: ''\r\n})\r\n\r\nonMounted(async () => {\r\n  const editor = new E('.edit');\r\n  editor.config.uploadImgMaxSize = 50 * 1024 * 1024;\r\n  editor.config.customUploadImg = function (resultFiles, insertImgFn) {\r\n    let img = window.URL.createObjectURL(new Blob(resultFiles));\r\n    uploadForm.img = img;\r\n    uploadForm.file = resultFiles[0];\r\n    new Promise((resole, reject) => {\r\n      let res = uploadImg();\r\n      resole(res)\r\n    }).then((res) => {\r\n      let imgUrl = `http://localhost:3000/${res}`\r\n      insertImgFn(imgUrl)\r\n    })\r\n  }\r\n  editor.create();\r\n\r\n  // 初始化数据\r\n  props.content && editor.txt.html(props.content)\r\n  // 配置 onchange 回调函数\r\n  editor.config.onchange = function (newHtml) {\r\n    emit('event', newHtml)\r\n\r\n  };\r\n})\r\n</script>"],"mappings":";AAOA,OAAOA,CAAC,MAAM,YAAY;AAC1B,SAASC,SAAiD,EAAEC,QAAQ,EAAEC,GAAG,QAAQ,KAAK;AACtF,OAAOC,MAAM,MAAM,0BAA0B;AAC7C,SAASC,SAAS,QAAQ,cAAc;;;;;;;;;;;;IAMxC,MAAMC,KAAK,GAAGA,CAAA,KAAM;MAClBC,MAAM,CAACC,GAAG,CAACC,KAAK,CAAC,CAAC;IACpB,CAAC;IAEDC,QAAY,CAAC;MAAEJ;IAAM,CAAC,CAAC;IACvB,IAAIK,GAAG,GAAGR,GAAG,CAAC,EAAE,CAAC;IAEjB,MAAMS,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,MAAMC,GAAG,GAAG,MAAMT,MAAM,CAAC,qBAAqB,EAAEU,UAAU,CAAC;MAC3D,IAAID,GAAG,CAACE,MAAM,KAAK,GAAG,EAAE,OAAOV,SAAS,CAACW,KAAK,CAAC,MAAM,CAAC;MACtD,OAAOH,GAAG,CAACI,IAAI,CAACA,IAAI,CAACC,GAAG;IAC1B,CAAC;IAED,IAAIJ,UAAU,GAAGZ,QAAQ,CAAC;MACxBiB,IAAI,EAAE,EAAE;MACRD,GAAG,EAAE;IACP,CAAC,CAAC;IAEFjB,SAAS,CAAC,YAAY;MACpB,MAAMM,MAAM,GAAG,IAAIP,CAAC,CAAC,OAAO,CAAC;MAC7BO,MAAM,CAACa,MAAM,CAACC,gBAAgB,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI;MACjDd,MAAM,CAACa,MAAM,CAACE,eAAe,GAAG,UAAUC,WAAW,EAAEC,WAAW,EAAE;QAClE,IAAIN,GAAG,GAAGO,MAAM,CAACC,GAAG,CAACC,eAAe,CAAC,IAAIC,IAAI,CAACL,WAAW,CAAC,CAAC;QAC3DT,UAAU,CAACI,GAAG,GAAGA,GAAG;QACpBJ,UAAU,CAACK,IAAI,GAAGI,WAAW,CAAC,CAAC,CAAC;QAChC,IAAIM,OAAO,CAAC,CAACC,MAAM,EAAEC,MAAM,KAAK;UAC9B,IAAIlB,GAAG,GAAGD,SAAS,CAAC,CAAC;UACrBkB,MAAM,CAACjB,GAAG,CAAC;QACb,CAAC,CAAC,CAACmB,IAAI,CAAEnB,GAAG,IAAK;UACf,IAAIoB,MAAM,GAAI,yBAAwBpB,GAAI,EAAC;UAC3CW,WAAW,CAACS,MAAM,CAAC;QACrB,CAAC,CAAC;MACJ,CAAC;MACD1B,MAAM,CAAC2B,MAAM,CAAC,CAAC;;MAEf;MACAC,KAAK,CAACC,OAAO,IAAI7B,MAAM,CAACC,GAAG,CAAC6B,IAAI,CAACF,KAAK,CAACC,OAAO,CAAC;MAC/C;MACA7B,MAAM,CAACa,MAAM,CAACkB,QAAQ,GAAG,UAAUC,OAAO,EAAE;QAC1CC,IAAI,CAAC,OAAO,EAAED,OAAO,CAAC;MAExB,CAAC;IACH,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}